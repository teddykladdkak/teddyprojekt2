<html>
	<head>
		<title>Explore</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="yes" name="mobile-web-app-capable">
		<meta content="minimum-scale=1.0, width=device-width, maximum-scale=0.6667, user-scalable=no" name="viewport">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<meta property="og:title" content="GymLund">
		<!-- <meta property="og:url" content="#lank#"> -->
		<meta property="og:type" content="website">
		<!--<meta property="og:description" content="Ger plats som man ska ta sig till.">-->
		<!--<meta property="og:image" content="ico/icon.jpg">

		<link rel="shortcut icon" href="ico/icon.ico">
		<link rel="icon" type="image/vnd.microsoft.icon" href="ico/icon.ico">
		<link rel="icon" type="image/png" href="ico/icon196x196.png">
		<link rel="apple-touch-icon-precomposed" href="ico/icon180x180.png">
		<link rel="apple-touch-icon-precomposed" sizes="76x76" href="ico/icon76x76.png">
		<link rel="apple-touch-icon-precomposed" sizes="120x120" href="ico/icon120x120.png">
		<link rel="apple-touch-icon-precomposed" sizes="152x152" href="ico/icon152x152.png">-->
		<script src="papaparse.min.js"></script>
		<script type="text/javascript">
            var stader = [];
			var stadData = [];
			var lon = '0';
			var lat = '0';
			Papa.parse('https://docs.google.com/spreadsheets/d/e/2PACX-1vS62litUjnRXwqy2jcQRNlBqRIrrzzHbpgY-hWWqoTcCNV6DXwL48GXi84tB0hVBV7G8tRfZlMtpeut/pub?gid=0&single=true&output=csv', {
				download: true,
				complete: function(results) {
                    console.log(results);
					var fistID = '';
                    for (var a = 0; a < results.data.length; a++){
            			if(results.data[a][0] == 'Städer'){}else{
                            console.log(results.data[a][0]);
                            console.log(results.data[a][1]);
                            stader[results.data[a][1]] = results.data[a];
							if(fistID == ''){
								fistID = results.data[a][1];
							};
                        };
                    };
					if(!stader[location.hash.replace('#', '')]){
						location.hash = '#' + fistID;
					};
					loadLocation();
				},
				error: function(results) {
					console.log('Något gick fel');
				}
			});
			function loadLocation(){
                console.log(stader[location.hash.replace('#', '')]);
                Papa.parse(stader[location.hash.replace('#', '')][2], {
					download: true,
					complete: function(results) {
						for (var a = 0; a < results.data.length; a++){
            				if(results.data[a][0] == 'Namn'){}else{
								stadData.push({
									"namn": results.data[a][0],
									"lat": results.data[a][1],
									"long": results.data[a][2],
									"img": results.data[a][3]
								})
							};
						};
						console.log(stadData);
						//if(!window['lon'] == '0' && !window['lat'] == '0'){addKm()};
						getLocation();
					},
					error: function(results) {
						console.log('Något gick fel');
					}
				});
			};
			function getLocation() {
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(showPosition);
				};
			};
			function showPosition(position) {
				window['lat'] = position.coords.latitude;
				window['lon'] = position.coords.longitude;
				addKm();
			};
			function pad (str, max) {str = str.toString();return str.length < max ? pad("0" + str, max) : str;};
			function getDistanceFromLatLonInKm(lon2,lat2,lon1,lat1) {
				if(lat1 == '0'){}else{
					var R = 6371;
					var dLat = deg2rad(lat2-lat1);
					var dLon = deg2rad(lon2-lon1); 
					var a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2);
					var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
					var d = R * c;
					return d;
				};
			};
			function deg2rad(deg) {return deg * (Math.PI/180)};
			function addKm(){
				var maxKM = 0;
				for (var i = stadData.length - 1; i >= 0; i--) {
					var km = Math.round(getDistanceFromLatLonInKm(stadData[i].long,stadData[i].lat,window['lon'],window['lat']) * 10);
					stadData[i].km = km;
					if(km > maxKM){maxKM = km + 1;};
				};
				document.getElementById('max').value = maxKM;
				document.getElementById('loader').setAttribute('style', 'display: none;');
				document.getElementById('content').setAttribute('style', 'display: block;');
			};
			function randomIntFromInterval(min, max) {
				return Math.floor(Math.random() * (max - min + 1) + min)
			};
			function dice(){
				var filtrerad = [];
				for (let i = 0; i < stadData.length; i++) {
					if(stadData[i].km >= document.getElementById('min').value && stadData[i].km <= document.getElementById('max').value){
						filtrerad.push(stadData[i]);
					};
				};
				var num = randomIntFromInterval(0, (filtrerad.length - 1));
				console.log(filtrerad[num]);
				if(filtrerad.length == 0){
					document.getElementById('result').innerHTML = `<p>Kunde inte hitta någon plats med inställda kliometer.</p>`;
				}else{
					document.getElementById('result').innerHTML = `<p>${filtrerad[num].namn} (${filtrerad[num].km} km)</p><div style="background-image: url('${filtrerad[num].img}');" class="previewIMG">`;
				};
			};
		</script>
		<style>
			body {
				text-align: center;
			}
			button {
				padding: 3px;
				margin-top: 10px;
			}
			#loader {
				width: 50px;
				height: 50px;
			}
			#content {
				display: none;
			}
			label {
				margin-right: 10px;
			}
			.previewIMG {
				display: inline-block;
				max-width: 500px;
				max-height: 500px;
				width: 100%;
				height: 100%;
				background-color: #000;
				background-repeat: no-repeat;
				background-size: cover;
			}
		</style>
	</head>
	<body>
		<svg id="loader" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><style>.spinner_EUy1{animation:spinner_grm3 1.2s infinite}.spinner_f6oS{animation-delay:.1s}.spinner_g3nX{animation-delay:.2s}.spinner_nvEs{animation-delay:.3s}.spinner_MaNM{animation-delay:.4s}.spinner_4nle{animation-delay:.5s}.spinner_ZETM{animation-delay:.6s}.spinner_HXuO{animation-delay:.7s}.spinner_YaQo{animation-delay:.8s}.spinner_GOx1{animation-delay:.9s}.spinner_4vv9{animation-delay:1s}.spinner_NTs9{animation-delay:1.1s}.spinner_auJJ{transform-origin:center;animation:spinner_T3O6 6s linear infinite}@keyframes spinner_grm3{0%,50%{animation-timing-function:cubic-bezier(.27,.42,.37,.99);r:1px}25%{animation-timing-function:cubic-bezier(.53,0,.61,.73);r:2px}}@keyframes spinner_T3O6{0%{transform:rotate(360deg)}100%{transform:rotate(0deg)}}</style><g class="spinner_auJJ"><circle class="spinner_EUy1" cx="12" cy="3" r="1"/><circle class="spinner_EUy1 spinner_f6oS" cx="16.50" cy="4.21" r="1"/><circle class="spinner_EUy1 spinner_NTs9" cx="7.50" cy="4.21" r="1"/><circle class="spinner_EUy1 spinner_g3nX" cx="19.79" cy="7.50" r="1"/><circle class="spinner_EUy1 spinner_4vv9" cx="4.21" cy="7.50" r="1"/><circle class="spinner_EUy1 spinner_nvEs" cx="21.00" cy="12.00" r="1"/><circle class="spinner_EUy1 spinner_GOx1" cx="3.00" cy="12.00" r="1"/><circle class="spinner_EUy1 spinner_MaNM" cx="19.79" cy="16.50" r="1"/><circle class="spinner_EUy1 spinner_YaQo" cx="4.21" cy="16.50" r="1"/><circle class="spinner_EUy1 spinner_4nle" cx="16.50" cy="19.79" r="1"/><circle class="spinner_EUy1 spinner_HXuO" cx="7.50" cy="19.79" r="1"/><circle class="spinner_EUy1 spinner_ZETM" cx="12" cy="21" r="1"/></g></svg>
		<div id="content">
			<label for="min">Min km</label><input type="number" id="min" value="0"><br>
			<label for="max">Max km</label><input type="number" placeholder="max km" id="max"><br>
			<button onclick="dice();" id="dice">Välj plats</button>
			<div id="result"></div>
		</div>
		<!--
			* Fixa layout
			* Länk och info om hur data kan läggas in
			* Lägg till fler städer
			* Möjlighet att byta stad
			* Visa vilken stad som för tillfället är vald
			* Länk till Google Map
			* Möjlighet att ta bort plats
			* Möjlighet att återställa tidigare bortvalda platser
			  * Återställa alla
			  * Återställa specifikt valda platser
			* Även lägga in olika sätt att ta sig till platsen på, alltså tränings instruktioner
			* Möjlighet för användare att lägga in egna träningsinstruktioner
			* Spara tidigare session, så även om sida laddas om kommer tidigare plats visas igen
		-->
	</body>
</html>